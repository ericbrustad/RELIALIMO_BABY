<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a0a0a">
  <title>Customer Login | RELIALIMO</title>
  <link rel="icon" href="favicon.ico">
  <link rel="manifest" href="customer-portal-manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="customer-portal.css">
  <!-- Load env.js synchronously before any modules -->
  <script src="/shared/env.js"></script>
</head>
<body>
  <div id="app">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="screen active" style="background: radial-gradient(ellipse at center, rgba(99, 102, 241, 0.3) 0%, rgba(26, 26, 46, 0.9) 50%, #1a1a2e 100%);">
      <div class="loading-content">
        <div class="logo-pulse" style="filter: drop-shadow(0 0 40px rgba(99, 102, 241, 0.6));"><img src="https://siumiadylwcrkaqsfwkj.supabase.co/storage/v1/object/public/images/reliabull%20limo%20logowhitecropped.png" alt="RELIALIMO" class="auth-logo" style="max-height: 70px; width: auto;"></div>
        <p style="font-size: 1.2rem; margin-top: 0.75rem; text-shadow: 0 0 15px rgba(99, 102, 241, 0.6); color: white;">Customer Portal</p>
        <div class="loading-spinner"></div>
      </div>
    </div>

    <!-- Auth Screen -->
    <div id="authScreen" class="screen">
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header" style="filter: drop-shadow(0 0 25px rgba(99, 102, 241, 0.4)); margin-bottom: 16px;">
            <img src="https://siumiadylwcrkaqsfwkj.supabase.co/storage/v1/object/public/images/reliabull%20limo%20logowhitecropped.png" 
                 alt="RELIALIMO" 
                 class="auth-logo"
                 style="max-height: 55px; width: auto;">
            <p class="auth-subtitle" style="font-size: 1rem; margin-top: 0.5rem; color: rgba(255,255,255,0.7);">Customer Portal</p>
          </div>

          <!-- Login Form -->
          <div id="loginForm" class="auth-form active">
            <h2 class="auth-title">Welcome Back</h2>
            <div class="form-group">
              <label for="loginEmail">Email Address</label>
              <input type="email" id="loginEmail" placeholder="your@email.com" autocomplete="email">
            </div>
            <div class="form-group">
              <label for="loginPassword">Password</label>
              <div class="password-input-wrapper">
                <input type="password" id="loginPassword" placeholder="Enter your password" autocomplete="current-password">
                <button type="button" class="password-toggle" data-target="loginPassword" aria-label="Show password">
                  <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                  </svg>
                </button>
              </div>
              <div class="form-options">
                <label class="remember-me-label">
                  <input type="checkbox" id="rememberMe" checked>
                  <span>Remember me for 30 days</span>
                </label>
                <a href="#" id="forgotPasswordLink" class="forgot-password-link">Forgot Password?</a>
              </div>
            </div>
            <button type="button" id="loginBtn" class="auth-btn auth-btn-primary">
              Sign In
            </button>
            <div class="auth-switch">
              <span>New customer?</span>
              <button type="button" id="showRegisterBtn" class="btn-link">Create Account</button>
            </div>
          </div>

          <!-- Registration Form -->
          <div id="registerForm" class="auth-form">
            <h2 class="auth-title">Create Account</h2>
            <div class="form-row" style="display: flex; gap: 12px;">
              <div class="form-group" style="flex: 1;">
                <label for="regFirstName">First Name*</label>
                <input type="text" id="regFirstName" placeholder="John" autocomplete="given-name">
              </div>
              <div class="form-group" style="flex: 1;">
                <label for="regLastName">Last Name*</label>
                <input type="text" id="regLastName" placeholder="Smith" autocomplete="family-name">
              </div>
            </div>
            <div class="form-group">
              <label for="regEmail">Email Address*</label>
              <input type="email" id="regEmail" placeholder="your@email.com" autocomplete="email">
            </div>
            <div class="form-group">
              <label for="regPhone">Phone Number*</label>
              <input type="tel" id="regPhone" placeholder="(555) 123-4567" autocomplete="tel">
            </div>
            <div class="form-group">
              <label for="regPassword">Password*</label>
              <div class="password-input-wrapper">
                <input type="password" id="regPassword" placeholder="Min. 8 characters" autocomplete="new-password">
                <button type="button" class="password-toggle" data-target="regPassword" aria-label="Show password">
                  <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="form-group">
              <label for="regPasswordConfirm">Confirm Password*</label>
              <div class="password-input-wrapper">
                <input type="password" id="regPasswordConfirm" placeholder="Confirm password" autocomplete="new-password">
                <button type="button" class="password-toggle" data-target="regPasswordConfirm" aria-label="Show password">
                  <svg class="eye-open" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg class="eye-closed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                  </svg>
                </button>
              </div>
            </div>
            <button type="button" id="registerBtn" class="auth-btn auth-btn-primary">
              Create Account
            </button>
            <div class="auth-switch">
              <span>Already have an account?</span>
              <button type="button" id="showLoginBtn" class="btn-link">Sign In</button>
            </div>
          </div>

          <!-- Forgot Password Form -->
          <div id="forgotPasswordForm" class="auth-form">
            <h2 class="auth-title">Reset Password</h2>
            <p class="form-description">Enter your email and we'll send you a password reset link.</p>
            <div class="form-group">
              <label for="resetEmail">Email Address</label>
              <input type="email" id="resetEmail" placeholder="your@email.com" autocomplete="email">
            </div>
            <button type="button" id="resetPasswordBtn" class="auth-btn auth-btn-primary">
              Send Reset Link
            </button>
            <div class="auth-switch">
              <button type="button" id="backToLoginBtn" class="btn-link">‚Üê Back to Sign In</button>
            </div>
          </div>
          
          <div class="auth-footer">
            <a href="https://relialimo.com">relialimo.com</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>
  </div>

  <script type="module">
    import { getSupabaseCredentials } from '/shared/supabase-config.js';
    import CustomerAuth from './customer-auth-service.js';
    
    // Check if already authenticated and redirect
    async function checkAuth() {
      const isAuth = await CustomerAuth.initAuth();
      if (isAuth) {
        const slug = CustomerAuth.getPortalSlug();
        window.location.href = slug ? `/${slug}` : '/';
        return true;
      }
      return false;
    }

    async function init() {
      const isAuth = await checkAuth();
      if (!isAuth) {
        document.getElementById('loadingScreen').classList.remove('active');
        document.getElementById('authScreen').classList.add('active');
      }
    }

    // Toggle forms
    document.getElementById('showRegisterBtn')?.addEventListener('click', () => {
      document.getElementById('loginForm').classList.remove('active');
      document.getElementById('registerForm').classList.add('active');
    });

    document.getElementById('showLoginBtn')?.addEventListener('click', () => {
      document.getElementById('registerForm').classList.remove('active');
      document.getElementById('forgotPasswordForm').classList.remove('active');
      document.getElementById('loginForm').classList.add('active');
    });

    document.getElementById('forgotPasswordLink')?.addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('loginForm').classList.remove('active');
      document.getElementById('forgotPasswordForm').classList.add('active');
    });

    document.getElementById('backToLoginBtn')?.addEventListener('click', () => {
      document.getElementById('forgotPasswordForm').classList.remove('active');
      document.getElementById('loginForm').classList.add('active');
    });

    // Password toggle
    document.querySelectorAll('.password-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.dataset.target;
        const input = document.getElementById(targetId);
        const eyeOpen = btn.querySelector('.eye-open');
        const eyeClosed = btn.querySelector('.eye-closed');
        if (input.type === 'password') {
          input.type = 'text';
          if (eyeOpen) eyeOpen.style.display = 'none';
          if (eyeClosed) eyeClosed.style.display = 'block';
        } else {
          input.type = 'password';
          if (eyeOpen) eyeOpen.style.display = 'block';
          if (eyeClosed) eyeClosed.style.display = 'none';
        }
      });
    });

    // Login handler - using the centralized auth service
    document.getElementById('loginBtn')?.addEventListener('click', async () => {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const rememberMe = document.getElementById('rememberMe')?.checked || false;

      if (!email || !password) {
        showToast('Please enter email and password', 'error');
        return;
      }

      const btn = document.getElementById('loginBtn');
      btn.disabled = true;
      btn.textContent = 'Signing In...';

      try {
        const { session, customer } = await CustomerAuth.login(email, password, rememberMe);
        
        showToast('Welcome back!', 'success');
        
        // Redirect to portal
        const slug = CustomerAuth.getPortalSlug();
        setTimeout(() => {
          window.location.href = slug ? `/${slug}` : '/';
        }, 500);

      } catch (err) {
        console.error('Login error:', err);
        showToast(err.message || 'Login failed', 'error');
        btn.disabled = false;
        btn.textContent = 'Sign In';
      }
    });

    // Registration handler
    document.getElementById('registerBtn')?.addEventListener('click', async () => {
      const firstName = document.getElementById('regFirstName').value.trim();
      const lastName = document.getElementById('regLastName').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const phone = document.getElementById('regPhone').value.trim();
      const password = document.getElementById('regPassword').value;
      const passwordConfirm = document.getElementById('regPasswordConfirm').value;

      if (!firstName || !lastName || !email || !phone || !password) {
        showToast('Please fill in all required fields', 'error');
        return;
      }

      if (password !== passwordConfirm) {
        showToast('Passwords do not match', 'error');
        return;
      }

      if (password.length < 8) {
        showToast('Password must be at least 8 characters', 'error');
        return;
      }

      const btn = document.getElementById('registerBtn');
      btn.disabled = true;
      btn.textContent = 'Creating Account...';

      try {
        const creds = getSupabaseCredentials();
        
        // Create auth user
        const authResponse = await fetch(`${creds.url}/auth/v1/signup`, {
          method: 'POST',
          headers: {
            'apikey': creds.anonKey,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            email, 
            password,
            data: { first_name: firstName, last_name: lastName }
          })
        });

        const authData = await authResponse.json();

        if (!authResponse.ok) {
          throw new Error(authData.error_description || authData.msg || 'Registration failed');
        }

        // Create customer record in accounts table
        const portalSlug = `${firstName}_${lastName}`.replace(/[^a-zA-Z0-9_]/g, '_');
        const customerData = {
          first_name: firstName,
          last_name: lastName,
          email: email.toLowerCase(),
          phone: phone,
          portal_slug: portalSlug,
          customer_type: 'individual',
          is_active: true,
          email_verified: false,
          onboarding_complete: false,
          created_at: new Date().toISOString()
        };

        const token = authData.access_token || creds.anonKey;
        const createResp = await fetch(`${creds.url}/rest/v1/accounts`, {
          method: 'POST',
          headers: {
            'apikey': creds.anonKey,
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
          },
          body: JSON.stringify(customerData)
        });

        if (createResp.ok) {
          const newCustomers = await createResp.json();
          if (newCustomers && newCustomers.length > 0) {
            localStorage.setItem('current_customer', JSON.stringify(newCustomers[0]));
          }
        }

        // Send verification email
        btn.textContent = 'Sending verification email...';
        await sendVerificationEmail(email, firstName, lastName, phone, creds);

        // Store session if available (but don't redirect yet - need to verify email)
        if (authData.access_token) {
          localStorage.setItem('customer_session', JSON.stringify(authData));
        }
        
        // Show success message for email verification
        showToast('Account created! Please check your email to verify and complete setup.', 'success');
        
        // Show a verification pending message
        showVerificationPendingUI(email, firstName);

      } catch (err) {
        console.error('Registration error:', err);
        showToast(err.message || 'Registration failed', 'error');
        btn.disabled = false;
        btn.textContent = 'Create Account';
      }
    });
    
    // Send verification email function
    async function sendVerificationEmail(email, firstName, lastName, phone, creds) {
      // Generate verification token
      const token = generateToken();
      const portalSlug = `${firstName}_${lastName}`.replace(/[^a-zA-Z0-9_]/g, '_');
      const verificationUrl = `https://account.relialimo.com/verify?token=${token}&email=${encodeURIComponent(email)}&redirect=${encodeURIComponent(portalSlug)}`;
      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString();
      
      // Store verification token in Supabase
      try {
        await fetch(`${creds.url}/rest/v1/customer_email_verifications`, {
          method: 'POST',
          headers: {
            'apikey': creds.anonKey,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: email.toLowerCase(),
            token,
            expires_at: expiresAt,
            user_data: { firstName, lastName, portalSlug, phone },
            verified: false,
            created_at: new Date().toISOString()
          })
        });
      } catch (e) {
        console.warn('Failed to store verification token:', e);
      }
      
      // Send verification email via API
      const subject = 'Welcome to RELIALIMO - Verify Your Email';
      const html = `
        <!DOCTYPE html>
        <html>
        <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"></head>
        <body style="margin: 0; padding: 0; font-family: 'Inter', Arial, sans-serif; background: #1a1a2e;">
          <table role="presentation" width="100%" cellspacing="0" cellpadding="0">
            <tr>
              <td align="center" style="padding: 40px 20px;">
                <table role="presentation" width="600" cellspacing="0" cellpadding="0" style="background: linear-gradient(135deg, #1e1e3f 0%, #252549 100%); border-radius: 16px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                  <tr>
                    <td align="center" style="padding: 40px 40px 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);">
                      <img src="https://siumiadylwcrkaqsfwkj.supabase.co/storage/v1/object/public/images/reliabull%20limo%20logowhitecropped.png" alt="RELIALIMO" style="max-width: 200px; height: auto;">
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 30px 40px;">
                      <h1 style="color: #fff; font-size: 28px; margin: 0 0 10px; text-align: center;">Welcome, ${firstName}! üéâ</h1>
                      <p style="color: #a0aec0; font-size: 16px; line-height: 1.6; margin: 0 0 30px; text-align: center;">Thank you for creating your RELIALIMO account. Please verify your email address to complete your account setup.</p>
                      <table role="presentation" width="100%" cellspacing="0" cellpadding="0">
                        <tr>
                          <td align="center">
                            <a href="${verificationUrl}" style="display: inline-block; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: #fff; text-decoration: none; padding: 16px 40px; border-radius: 12px; font-size: 18px; font-weight: 600; box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);">‚úÖ Verify My Email</a>
                          </td>
                        </tr>
                      </table>
                      <p style="color: #718096; font-size: 14px; line-height: 1.6; margin: 30px 0 0; text-align: center;">This link will expire in 24 hours. If you didn't create this account, you can safely ignore this email.</p>
                      <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <p style="color: #a0aec0; font-size: 12px; margin: 0 0 10px;">Having trouble with the button? Copy and paste this link:</p>
                        <p style="color: #6366f1; font-size: 12px; word-break: break-all; margin: 0;">${verificationUrl}</p>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="padding: 20px 40px 30px; border-top: 1px solid rgba(255,255,255,0.1);">
                      <p style="color: #718096; font-size: 12px; margin: 0; text-align: center;">Your portal URL after verification:<br><strong style="color: #a0aec0;">https://account.relialimo.com/${portalSlug}</strong></p>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </body>
        </html>
      `;
      
      try {
        await fetch('/api/send-email', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ to: email, subject, html })
        });
        console.log('‚úÖ Verification email sent');
      } catch (e) {
        console.error('Failed to send verification email:', e);
        // Show the verification URL in console for development
        console.log('üìß Verification URL (for testing):', verificationUrl);
      }
    }
    
    // Generate secure token
    function generateToken() {
      const array = new Uint8Array(32);
      crypto.getRandomValues(array);
      return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
    }
    
    // Show verification pending UI
    function showVerificationPendingUI(email, firstName) {
      const registerForm = document.getElementById('registerForm');
      registerForm.innerHTML = `
        <div class="verification-pending" style="text-align: center; padding: 20px;">
          <div style="font-size: 64px; margin-bottom: 20px;">üìß</div>
          <h2 class="auth-title" style="color: #22c55e;">Check Your Email!</h2>
          <p style="color: #a0aec0; margin-bottom: 20px;">
            We've sent a verification link to:<br>
            <strong style="color: #fff;">${email}</strong>
          </p>
          <p style="color: #718096; font-size: 14px; margin-bottom: 30px;">
            Click the link in the email to verify your account and complete your setup with:
          </p>
          <div style="background: rgba(99, 102, 241, 0.1); border-radius: 12px; padding: 16px; margin-bottom: 20px; text-align: left;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; color: #e2e8f0;">
              <span>üè†</span> <span>Home address setup</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; color: #e2e8f0;">
              <span>‚úàÔ∏è</span> <span>Nearby airport selection</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; color: #e2e8f0;">
              <span>üì±</span> <span>Phone number verification</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px; color: #e2e8f0;">
              <span>üí≥</span> <span>Payment method (optional)</span>
            </div>
          </div>
          <button type="button" class="btn-link" onclick="resendVerificationEmail('${email}', '${firstName}')" style="color: #6366f1; text-decoration: underline;">
            Didn't receive the email? Resend
          </button>
          <br><br>
          <button type="button" class="btn-link" id="backToLoginFromVerify" style="color: #a0aec0;">
            Already verified? Sign in
          </button>
        </div>
      `;
      
      document.getElementById('backToLoginFromVerify')?.addEventListener('click', () => {
        window.location.reload();
      });
    }
    
    // Resend verification email
    window.resendVerificationEmail = async function(email, firstName) {
      const creds = getSupabaseCredentials();
      showToast('Resending verification email...', 'info');
      
      try {
        // Get existing user data from stored verification
        const resp = await fetch(
          `${creds.url}/rest/v1/customer_email_verifications?email=eq.${encodeURIComponent(email.toLowerCase())}&order=created_at.desc&limit=1`,
          { headers: { 'apikey': creds.anonKey } }
        );
        
        let lastName = '';
        let phone = '';
        
        if (resp.ok) {
          const records = await resp.json();
          if (records.length > 0 && records[0].user_data) {
            lastName = records[0].user_data.lastName || '';
            phone = records[0].user_data.phone || '';
          }
        }
        
        await sendVerificationEmail(email, firstName, lastName, phone, creds);
        showToast('Verification email sent!', 'success');
      } catch (e) {
        showToast('Failed to resend. Please try again.', 'error');
      }
    };

    // Password reset handler - using auth service
    document.getElementById('resetPasswordBtn')?.addEventListener('click', async () => {
      const email = document.getElementById('resetEmail').value.trim();
      
      if (!email) {
        showToast('Please enter your email', 'error');
        return;
      }

      const btn = document.getElementById('resetPasswordBtn');
      btn.disabled = true;
      btn.textContent = 'Sending...';

      try {
        await CustomerAuth.sendPasswordReset(email);

        showToast('Reset link sent! Check your email.', 'success');
        setTimeout(() => {
          document.getElementById('forgotPasswordForm').classList.remove('active');
          document.getElementById('loginForm').classList.add('active');
        }, 2000);

      } catch (err) {
        console.error('Reset error:', err);
        showToast(err.message || 'Failed to send reset link', 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Send Reset Link';
      }
    });

    // Toast notification
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      setTimeout(() => {
        toast.className = 'toast';
      }, 3000);
    }

    // Enter key handlers
    document.getElementById('loginPassword')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('loginBtn').click();
    });
    document.getElementById('regPasswordConfirm')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('registerBtn').click();
    });
    document.getElementById('resetEmail')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('resetPasswordBtn').click();
    });

    // Initialize
    init();
  </script>
</body>
</html>
