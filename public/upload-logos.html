<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Logos to Supabase</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 { color: #c9a227; margin-bottom: 10px; }
        .subtitle { color: #888; margin-bottom: 30px; }
        .upload-section {
            background: #252525;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .upload-section h3 { color: #c9a227; margin-top: 0; }
        .upload-section p { color: #aaa; font-size: 14px; }
        input[type="file"] {
            display: block;
            width: 100%;
            padding: 12px;
            background: #333;
            border: 2px dashed #555;
            border-radius: 8px;
            color: #fff;
            margin: 16px 0;
            cursor: pointer;
        }
        input[type="file"]:hover { border-color: #c9a227; }
        button {
            background: #c9a227;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #d4af37; }
        button:disabled { background: #666; cursor: not-allowed; }
        .status {
            margin-top: 16px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }
        .status.success { display: block; background: #1a4d1a; color: #4ade80; }
        .status.error { display: block; background: #4d1a1a; color: #f87171; }
        .status.info { display: block; background: #1a3d4d; color: #60a5fa; }
        .preview { max-width: 300px; margin: 16px 0; border-radius: 8px; }
        .url-box {
            background: #333;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin-top: 12px;
        }
        .copy-btn {
            background: #444;
            color: #fff;
            padding: 6px 12px;
            font-size: 12px;
            margin-left: 8px;
        }
        .instructions {
            background: #1a3d4d;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .instructions h3 { color: #60a5fa; margin-top: 0; }
        .instructions ol { color: #ccc; line-height: 1.8; }
        .instructions code { background: #333; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üêÇ Upload RELIALIMO Logos</h1>
    <p class="subtitle">Upload logos to Supabase Storage bucket "images/"</p>

    <div class="instructions">
        <h3>üìã Before You Start</h3>
        <ol>
            <li>Go to <a href="https://supabase.com/dashboard" target="_blank" style="color:#60a5fa">Supabase Dashboard</a></li>
            <li>Navigate to <strong>Storage</strong> ‚Üí Click <strong>"New bucket"</strong></li>
            <li>Create bucket named: <code>images</code></li>
            <li>Set to <strong>Public</strong> bucket (so images can be accessed)</li>
            <li>Come back here and upload your logos!</li>
        </ol>
    </div>

    <!-- Main Logo (Black text, Red bull) -->
    <div class="upload-section">
        <h3>üî¥ Main Logo (for splash page)</h3>
        <p>Black text with RED bull - Use for: Landing page, light backgrounds</p>
        <p>Save as: <strong>relialimo-logo-main.png</strong></p>
        <input type="file" id="mainLogoFile" accept="image/*">
        <img id="mainPreview" class="preview" style="display:none; background:#fff; padding:20px;">
        <button onclick="uploadLogo('main')">Upload Main Logo</button>
        <div id="mainStatus" class="status"></div>
        <div id="mainUrl" class="url-box" style="display:none;"></div>
    </div>

    <!-- Dark Logo (Red text, Black bull) -->
    <div class="upload-section">
        <h3>‚ö´ Dark Theme Logo</h3>
        <p>RED text with BLACK bull - Use for: Dark backgrounds, admin portal</p>
        <p>Save as: <strong>relialimo-logo-dark.png</strong></p>
        <input type="file" id="darkLogoFile" accept="image/*">
        <img id="darkPreview" class="preview" style="display:none; background:#000; padding:20px;">
        <button onclick="uploadLogo('dark')">Upload Dark Logo</button>
        <div id="darkStatus" class="status"></div>
        <div id="darkUrl" class="url-box" style="display:none;"></div>
    </div>

    <script src="/shared/env.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        let supabase;

        // Initialize Supabase
        async function initSupabase() {
            const creds = getSupabaseCredentials();
            if (!creds.url || !creds.anonKey) {
                alert('Missing Supabase credentials. Check env.js');
                return;
            }
            supabase = window.supabase.createClient(creds.url, creds.anonKey);
            console.log('Supabase initialized');
        }

        // Preview image on select
        document.getElementById('mainLogoFile').addEventListener('change', function(e) {
            previewImage(e.target.files[0], 'mainPreview');
        });
        document.getElementById('darkLogoFile').addEventListener('change', function(e) {
            previewImage(e.target.files[0], 'darkPreview');
        });

        function previewImage(file, previewId) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById(previewId);
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        async function uploadLogo(type) {
            const fileInput = document.getElementById(type + 'LogoFile');
            const statusEl = document.getElementById(type + 'Status');
            const urlEl = document.getElementById(type + 'Url');
            
            const file = fileInput.files[0];
            if (!file) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Please select a file first';
                return;
            }

            statusEl.className = 'status info';
            statusEl.textContent = 'Uploading...';

            const fileName = type === 'main' ? 'relialimo-logo-main.png' : 'relialimo-logo-dark.png';

            try {
                // Delete existing file first (in case of update)
                await supabase.storage.from('images').remove([fileName]);

                // Upload new file
                const { data, error } = await supabase.storage
                    .from('images')
                    .upload(fileName, file, {
                        cacheControl: '3600',
                        upsert: true,
                        contentType: file.type
                    });

                if (error) throw error;

                // Get public URL
                const { data: urlData } = supabase.storage
                    .from('images')
                    .getPublicUrl(fileName);

                statusEl.className = 'status success';
                statusEl.textContent = '‚úì Uploaded successfully!';
                
                urlEl.style.display = 'block';
                urlEl.innerHTML = `
                    <strong>Public URL:</strong><br>
                    ${urlData.publicUrl}
                    <button class="copy-btn" onclick="copyUrl('${urlData.publicUrl}')">üìã Copy</button>
                `;

                console.log('Uploaded:', urlData.publicUrl);

            } catch (err) {
                console.error('Upload error:', err);
                statusEl.className = 'status error';
                statusEl.textContent = 'Error: ' + err.message;
                
                if (err.message.includes('bucket') || err.message.includes('not found')) {
                    statusEl.textContent += '\n\n‚ö†Ô∏è Make sure you created the "images" bucket in Supabase Storage!';
                }
            }
        }

        function copyUrl(url) {
            navigator.clipboard.writeText(url);
            alert('URL copied to clipboard!');
        }

        // Initialize on load
        initSupabase();
    </script>
</body>
</html>
