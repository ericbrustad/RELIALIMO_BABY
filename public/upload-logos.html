<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Logos to Supabase</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 { color: #c9a227; margin-bottom: 10px; }
        .subtitle { color: #888; margin-bottom: 30px; }
        .upload-section {
            background: #252525;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .upload-section h3 { color: #c9a227; margin-top: 0; }
        .upload-section p { color: #aaa; font-size: 14px; }
        input[type="file"] {
            display: block;
            width: 100%;
            padding: 12px;
            background: #333;
            border: 2px dashed #555;
            border-radius: 8px;
            color: #fff;
            margin: 16px 0;
            cursor: pointer;
        }
        input[type="file"]:hover { border-color: #c9a227; }
        button {
            background: #c9a227;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #d4af37; }
        button:disabled { background: #666; cursor: not-allowed; }
        .status {
            margin-top: 16px;
            padding: 12px;
            border-radius: 8px;
            display: none;
            white-space: pre-wrap;
        }
        .status.success { display: block; background: #1a4d1a; color: #4ade80; }
        .status.error { display: block; background: #4d1a1a; color: #f87171; }
        .status.info { display: block; background: #1a3d4d; color: #60a5fa; }
        .preview { max-width: 300px; margin: 16px 0; border-radius: 8px; }
        .url-box {
            background: #333;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin-top: 12px;
        }
        .copy-btn {
            background: #444;
            color: #fff;
            padding: 6px 12px;
            font-size: 12px;
            margin-left: 8px;
        }
        .instructions {
            background: #1a3d4d;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .instructions h3 { color: #60a5fa; margin-top: 0; }
        .instructions ol { color: #ccc; line-height: 1.8; }
        .instructions code { background: #333; padding: 2px 6px; border-radius: 4px; }
        .init-status { 
            padding: 10px 16px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            font-size: 14px;
        }
        .init-status.ok { background: #1a4d1a; color: #4ade80; }
        .init-status.error { background: #4d1a1a; color: #f87171; }
    </style>
</head>
<body>
    <h1>üêÇ Upload RELIALIMO Logos</h1>
    <p class="subtitle">Upload logos to Supabase Storage bucket "images/"</p>

    <div id="initStatus" class="init-status">‚è≥ Initializing Supabase...</div>

    <div class="instructions">
        <h3>üìã Before You Start</h3>
        <ol>
            <li>Go to <a href="https://supabase.com/dashboard" target="_blank" style="color:#60a5fa">Supabase Dashboard</a></li>
            <li>Navigate to <strong>Storage</strong> ‚Üí Click <strong>"New bucket"</strong></li>
            <li>Create bucket named: <code>images</code></li>
            <li>Set to <strong>Public</strong> bucket (so images can be accessed)</li>
            <li>Come back here and upload your logos!</li>
        </ol>
    </div>

    <!-- Main Logo (Black text, Red bull) -->
    <div class="upload-section">
        <h3>üî¥ Main Logo (for splash page)</h3>
        <p>Black text with RED bull - Use for: Landing page, light backgrounds</p>
        <p>Save as: <strong>relialimo-logo-main.png</strong></p>
        <input type="file" id="mainLogoFile" accept="image/*">
        <img id="mainPreview" class="preview" style="display:none; background:#fff; padding:20px;">
        <button id="mainUploadBtn">Upload Main Logo</button>
        <div id="mainStatus" class="status"></div>
        <div id="mainUrl" class="url-box" style="display:none;"></div>
    </div>

    <!-- Dark Logo (Red text, Black bull) -->
    <div class="upload-section">
        <h3>‚ö´ Dark Theme Logo</h3>
        <p>RED text with BLACK bull - Use for: Dark backgrounds, admin portal</p>
        <p>Save as: <strong>relialimo-logo-dark.png</strong></p>
        <input type="file" id="darkLogoFile" accept="image/*">
        <img id="darkPreview" class="preview" style="display:none; background:#000; padding:20px;">
        <button id="darkUploadBtn">Upload Dark Logo</button>
        <div id="darkStatus" class="status"></div>
        <div id="darkUrl" class="url-box" style="display:none;"></div>
    </div>

    <!-- Load env.js first -->
    <script src="env.js"></script>
    
    <!-- Load Supabase JS SDK (UMD version for browser) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    
    <script>
        let supabaseClient = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initSupabase();
            
            // Preview handlers
            document.getElementById('mainLogoFile').addEventListener('change', function(e) {
                previewImage(e.target.files[0], 'mainPreview');
            });
            document.getElementById('darkLogoFile').addEventListener('change', function(e) {
                previewImage(e.target.files[0], 'darkPreview');
            });
            
            // Upload button handlers
            document.getElementById('mainUploadBtn').addEventListener('click', function() {
                uploadLogo('main');
            });
            document.getElementById('darkUploadBtn').addEventListener('click', function() {
                uploadLogo('dark');
            });
        });

        function initSupabase() {
            const statusEl = document.getElementById('initStatus');
            
            try {
                // Get credentials from env.js (window.ENV)
                const url = window.ENV?.SUPABASE_URL;
                const key = window.ENV?.SUPABASE_ANON_KEY;
                
                if (!url || !key) {
                    statusEl.className = 'init-status error';
                    statusEl.textContent = '‚ùå Missing Supabase credentials in env.js. URL: ' + (url ? 'OK' : 'MISSING') + ', Key: ' + (key ? 'OK' : 'MISSING');
                    console.error('ENV:', window.ENV);
                    return;
                }
                
                // Create Supabase client using the UMD bundle
                supabaseClient = window.supabase.createClient(url, key);
                
                statusEl.className = 'init-status ok';
                statusEl.textContent = '‚úÖ Supabase connected: ' + url;
                console.log('Supabase initialized successfully');
                
            } catch (err) {
                statusEl.className = 'init-status error';
                statusEl.textContent = '‚ùå Error: ' + err.message;
                console.error('Init error:', err);
            }
        }

        function previewImage(file, previewId) {
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById(previewId);
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        async function uploadLogo(type) {
            const fileInput = document.getElementById(type + 'LogoFile');
            const statusEl = document.getElementById(type + 'Status');
            const urlEl = document.getElementById(type + 'Url');
            
            if (!supabaseClient) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Supabase not initialized. Check the status message above.';
                return;
            }
            
            const file = fileInput.files[0];
            if (!file) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Please select a file first';
                return;
            }

            statusEl.className = 'status info';
            statusEl.textContent = 'Uploading...';

            const fileName = type === 'main' ? 'relialimo-logo-main.png' : 'relialimo-logo-dark.png';

            try {
                // Try to delete existing file first (ignore errors)
                try {
                    await supabaseClient.storage.from('images').remove([fileName]);
                } catch (e) {
                    console.log('Delete existing failed (OK if file doesnt exist):', e);
                }

                // Upload new file
                const { data, error } = await supabaseClient.storage
                    .from('images')
                    .upload(fileName, file, {
                        cacheControl: '3600',
                        upsert: true,
                        contentType: file.type
                    });

                if (error) throw error;

                // Get public URL
                const { data: urlData } = supabaseClient.storage
                    .from('images')
                    .getPublicUrl(fileName);

                statusEl.className = 'status success';
                statusEl.textContent = '‚úì Uploaded successfully!';
                
                urlEl.style.display = 'block';
                urlEl.innerHTML = `
                    <strong>Public URL:</strong><br>
                    ${urlData.publicUrl}
                    <button class="copy-btn" onclick="copyUrl('${urlData.publicUrl}')">üìã Copy</button>
                `;

                console.log('Uploaded:', urlData.publicUrl);

            } catch (err) {
                console.error('Upload error:', err);
                statusEl.className = 'status error';
                
                let errorMsg = 'Error: ' + (err.message || JSON.stringify(err));
                
                if (err.message?.includes('Bucket not found') || err.statusCode === 400) {
                    errorMsg += '\n\n‚ö†Ô∏è The "images" bucket does not exist. Create it in Supabase Dashboard ‚Üí Storage ‚Üí New bucket';
                }
                
                if (err.message?.includes('security') || err.message?.includes('policy') || err.message?.includes('row-level')) {
                    errorMsg += '\n\n‚ö†Ô∏è Storage needs upload permissions. Go to Supabase ‚Üí Storage ‚Üí images ‚Üí Policies ‚Üí Add policy for INSERT';
                }
                
                statusEl.textContent = errorMsg;
            }
        }

        function copyUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('URL copied to clipboard!');
            }).catch(() => {
                prompt('Copy this URL:', url);
            });
        }
    </script>
</body>
</html>
